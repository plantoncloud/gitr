---
description: Ask-only rule to generate the exact shell command to create a pull request for gitr. Outputs copyable command with PR title, branch name, commit message, and body.
globs:
alwaysApply: false
---

# Rule: Generate PR Creation Command for Gitr (ask-only)

Purpose: When invoked, generate the exact shell command needed to create a pull request for the gitr repository. This is an ask-only rule that outputs a ready-to-run command without executing it.

This rule is designed for ask mode only. Do not modify files, run commands, or execute git operations. Output only the copyable command block.

Usage: In Ask mode, invoke explicitly as `@generate-gitr-pr-command` or `@pr-command`.

References: `@generate-gitr-pr-info`

## How to respond (strict)

1. Generate PR title and description using the same logic as `@generate-gitr-pr-info`
2. Derive branch name from the title
3. Create the PR description file in `.cursor/workspace/` directory
4. Output a single copyable shell command block

## Output format

**Step 1: Create PR Description File**

Use the `write` tool to create `/Users/suresh/scm/github.com/plantoncloud/gitr/.cursor/workspace/pr-description-<timestamp>.md` with the PR description content.

**Step 2: Execution Command**

Output a bash code block:

```bash
# Repository: gitr
# PR Title: <title>

cd /Users/suresh/scm/github.com/plantoncloud/gitr && \
git checkout -b "<branch-name>" 2>/dev/null || git checkout "<branch-name>" && \
git add -A && \
git commit -m "<title>" && \
git push -u origin "<branch-name>" && \
gh pr create \
  --title "<title>" \
  --body-file ".cursor/workspace/pr-description-<timestamp>.md" \
  --web
```

**Step 3: Cleanup Command** (output at the end)

```bash
# Cleanup: Run after PR is created
rm -f /Users/suresh/scm/github.com/plantoncloud/gitr/.cursor/workspace/pr-description-*.md
```

## Branch naming heuristic

Same as other PR rules:

1. Extract `<type>` (prefix before `(`) from title
2. Extract `<scope>` (inside parentheses) from title
3. Create slug from remainder of title (lowercase, hyphenated, max 40 chars)
4. Branch name: `<type>/<scope-slug>-<title-slug>`
   - Convert slashes in scope to hyphens
   - Example: `fix(pkg/git): improve error` → `fix/pkg-git-improve-error`
5. Fallback: `chore/repo-<slug>` if parsing fails

## PR title generation

Use the same logic as `@generate-gitr-pr-info`:

- Conventional Commit prefix: `feat`, `fix`, `refactor`, `docs`, `test`, `perf`, `ci`, `build`, `chore`, `revert`
- Component-aware scope from changed file paths
- Imperative mood, concise, ≤ 72 characters
- No trailing period

## PR description generation

Use the same sections as `@generate-gitr-pr-info`:

```markdown
## Summary
<1–3 sentences>

## Context
<why this change was needed>

## Changes
- <key change 1>
- <key change 2>

## Implementation notes
- <notable decision or trade-off>

## Breaking changes
- <explicitly list or state "None">

## Test plan
- <how verified>

## Risks
- <risks and rollback>

## Checklist
- [ ] Docs updated (if needed)
- [ ] Tests added/updated (if needed)
- [ ] Backward compatible
```

## Example output

**PR Description File: `/Users/suresh/scm/github.com/plantoncloud/gitr/.cursor/workspace/pr-description-1731589530.md`** ✓ Created

---

```bash
# Repository: gitr
# PR Title: feat(pkg/git): add remote branch validation with fallback to default branch

cd /Users/suresh/scm/github.com/plantoncloud/gitr && \
git checkout -b "feat/pkg-git-add-remote-branch-validation-with-fallback" 2>/dev/null || git checkout "feat/pkg-git-add-remote-branch-validation-with-fallback" && \
git add -A && \
git commit -m "feat(pkg/git): add remote branch validation with fallback to default branch" && \
git push -u origin "feat/pkg-git-add-remote-branch-validation-with-fallback" && \
gh pr create \
  --title "feat(pkg/git): add remote branch validation with fallback to default branch" \
  --body-file ".cursor/workspace/pr-description-1731589530.md" \
  --web
```

---

```bash
# Cleanup: Run after PR is created
rm -f /Users/suresh/scm/github.com/plantoncloud/gitr/.cursor/workspace/pr-description-*.md
```

## Command breakdown

The command does the following:

1. **Change to gitr directory**: `cd /Users/suresh/scm/github.com/plantoncloud/gitr`
2. **Create/switch to branch**: `git checkout -b "<branch-name>"` (or switch if exists)
3. **Stage all changes**: `git add -A`
4. **Commit with message**: `git commit -m "<title>"`
5. **Push to remote**: `git push -u origin "<branch-name>"`
6. **Create PR**: `gh pr create --title "<title>" --body-file "..." --web`
   - `--web` flag opens the PR in browser after creation

## Optional flags

You can append these to the `gh pr create` command:

```bash
# Create as draft
--draft

# Add reviewers
--reviewer "username1,username2"

# Add labels
--label "enhancement,documentation"

# Set different base branch
--base "develop"

# Add assignees
--assignee "username"

# Add to project
--project "project-name"
```

## Example with options

```bash
cd /Users/suresh/scm/github.com/plantoncloud/gitr && \
git checkout -b "feat/pkg-git-add-remote-branch-validation" 2>/dev/null || git checkout "feat/pkg-git-add-remote-branch-validation" && \
git add -A && \
git commit -m "feat(pkg/git): add remote branch validation" && \
git push -u origin "feat/pkg-git-add-remote-branch-validation" && \
gh pr create \
  --title "feat(pkg/git): add remote branch validation" \
  --body-file ".cursor/workspace/pr-description-1731589530.md" \
  --draft \
  --reviewer "teammate1" \
  --label "enhancement" \
  --web
```

## Prerequisites

Before running the generated command, ensure:

1. **GitHub CLI installed**: `gh` must be installed
   ```bash
   brew install gh
   ```

2. **GitHub CLI authenticated**: Must be logged in
   ```bash
   gh auth login
   ```

3. **Git configured**: User name and email set
   ```bash
   git config --global user.name "Your Name"
   git config --global user.email "your.email@example.com"
   ```

4. **Remote configured**: Repository has `origin` remote
   ```bash
   git remote -v
   ```

## Error handling

If the command fails:

- **Branch exists**: The `|| git checkout` part handles existing branches
- **No changes to commit**: Git will show "nothing to commit" - remove the commit step if already committed
- **Already pushed**: Git will indicate branch is up-to-date
- **gh not authenticated**: Run `gh auth login` first
- **No remote**: Add remote with `git remote add origin <url>`

## When to use this rule

Use this rule when you want to:

- Review the PR creation command before executing it
- Copy/paste the command to run it manually
- Understand what will happen when creating a PR
- Modify the command before execution (e.g., add draft flag, add reviewers)
- Share the command with others
- Create a PR but want to review each step

## Workflow integration

This rule works well with:

- `@generate-gitr-pr-info` - See the PR info before generating the command
- `@commit-gitr-changes` - Commit changes first if you want separate commit messages
- `@create-gitr-changelog` - Create changelog before PR

## Notes

- **Idempotent branch creation**: The command uses `||` to handle existing branches gracefully
- **Automatic upstream tracking**: The `-u` flag in `git push` sets up tracking
- **Opens in browser**: The `--web` flag automatically opens the PR page
- **Body file path**: Relative to the repository root (`.cursor/workspace/pr-description-*.md`)
- **Timestamp**: Uses epoch time in filename to ensure uniqueness
- **Command chaining**: Uses `&&` to chain operations - if any step fails, subsequent steps won't run

@generate-gitr-pr-info
